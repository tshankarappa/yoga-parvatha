<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Shanmukhi Timer</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="container stopTimer">
        <button id="start" class="btn-push" onclick="startTimer()"></button>
        <button id="pause" class="btn-push" onclick="pauseTimer(true)"></button>
        <button id="resume" class="btn-push" onclick="pauseTimer(event,false)"></button>
        <button id="stop" class="btn-push" onclick="stopTimer()"></button>
        <button id="next" class="btn-push" onclick="nextStep()"></button>
        <button id="mute" onclick="mutebutton(event)"></button>
    </div>
    <div class="main-content">
        <p id="timer">Shanmukhi</p>
    </div>
    <script src="./nosleep.min.js"></script>
    <script>
        let noSleep = new NoSleep();
        let timer;
        let mute = false;
        let taskArray = [
            ['Start', 5],
            ['Naadi Shuddhi', 240],
            ['AUM Chanting', 110],
            ['Shanmukhi Mudra', 105],
            ['Meditate', 420]
        ];

        let i = 0;
        let currentTaskTime = taskArray[i][1];
        let pause = false;
        let totalTime = 0;

        let bell = new Audio("/assets/audio/bell.mp3");
        let allAudio = [bell];

        function preloadAudio() {
            allAudio.forEach((audio) => {
                audio.play();
                audio.pause();
                audio.currentTime = 0;
            });
        }
        
        function timerfunction() {
            if (pause) {
                return;
            }

            document.getElementById("timer").innerHTML = `${currentTaskTime} s <br>${taskArray[i][0]}`;
            if (currentTaskTime == 0) {
                i++;

                if (!mute) {
                    bell.play();
                }

                if (taskArray.length > i) {
                    currentTaskTime = taskArray[i][1];
                    return;
                } else {
                    stopTimer(event);
                    return;
                }
            }
            
            if (!document.hasFocus() || (totalTime > 3300)){
                stopTimer(event);
                return;
            }
            totalTime++;
            currentTaskTime--;
            return;
        }

        function mutebutton(event) {
            mute = !mute;
            event.target.style.background = mute ? "url(/assets/images/icons/mute.png)" : "url(/assets/images/icons/unmute.png)";
        }

        function nextStep() {
            currentTaskTime = 0;
        }

        function startTimer() {
            preloadAudio();
            document.querySelector(".container").classList.replace("stopTimer", "startTimer")
            i = 0;
            currentTaskTime = taskArray[i][1];
            pause = false;
            timer = setInterval(timerfunction, 1000);
            noSleep.enable();
        }

        function stopTimer() {
            clearInterval(timer);
            noSleep.disable();
            document.getElementById("timer").innerHTML = "completed";
            document.querySelector(".container").classList.value = "container stopTimer";
            return;
        }

        function pauseTimer(flag) {
            pause = flag;
            document.querySelector(".container").classList.toggle("pauseTimer", flag);
        }
    </script>
</body>
</html>